title: $:/plugins/reidgould/blc/templates/view/CardMacros
tags: $:/tags/Macro

\define wikitext-Text-IfTextDisplay()
  <$list filter="[<currentBoardTiddler>!field:displaytext[no]]" variable="">
    <$transclude field="text" mode="block" />
  </$list>
\end

\define wikitext-Image-IfImageDisplay()
  <$list filter="[<currentBoardTiddler>!field:displayimages[no]]" variable="">
    <$transclude field="text" mode="block" />
  </$list>
\end

\define wikitext-CardView(palette-tagBackground)
  <$macrocall $name="wikitext-CardView_internal" tagBackground={{$palette-tagBackground$##tag-background}} />
\end
\define wikitext-CardView_internal(tagBackground)
  <div class="blc-droppable-placeholder-thin">
    <div class="blc-droppable-placeholder-thin-child"></div>
  </div>
  <$draggable tiddler=<<currentTiddler>> class="tc-tiddler-frame blc-Card ">
    <$set name="foregroundColor" value={{!!color}} >
      <div class="blc-CardIconFloat" style=<<style-IconColor>> >
        <span class="inlineImg"><$transclude tiddler={{!!icon}} mode="inline" /></span>
      </div>
    </$set>
    <div class="blc-CardFloats blc-Card-visDownsize">
      <$button popup=<<tiddler-popupTagsState>> tooltip={{$:/language/Buttons/Tag/Hint}} aria-label={{$:/language/Buttons/Tag/Caption}} class="tc-btn-invisible">
        {{$:/core/images/tag-button}}
      </$button>
      <$button message="tm-edit-tiddler" tooltip={{$:/language/Buttons/Edit/Hint}} aria-label={{$:/language/Buttons/Edit/Caption}} class="tc-btn-invisible" >
        {{$:/core/images/edit-button}}
      </$button>
    </div>
    <$reveal type="popup" state=<<tiddler-popupTagsState>> position="belowleft" class="tc-popup-keep blc-popupTag-vis">
      <$transclude tiddler="$:/core/ui/EditTemplate/tags" />
    </$reveal>
    <div class="blc-CardTagPreview">
      <$list filter="[<currentTiddler>tags[]] -[<currentListTiddler>] +[sort[title]]">
        <$set name="val-TagColor" filter="[<currentTiddler>has[color]]" value={{!!color}} emptyValue="""$tagBackground$""" >
          <$set name="field-shorttextOrTitle" filter="[<currentTiddler>get[shorttext]]" emptyValue=<<currentTiddler>> >
            <div class="blc-CardTagPreviewChild" style=<<style-TagColor>> title=<<field-shorttextOrTitle>> ></div>
          </$set>
        </$set>
      </$list>
    </div>
    <div class="blc-CardColorPreview">
      <$list filter="[<currentTiddler>has:field[color]]">
        <$set name="val-TagColor" value={{{ [<currentTiddler>get[color]] }}} >
          <div class="blc-CardColorPreviewChild" style=<<style-TagColor>> ></div>
        </$set>
      </$list>
    </div>
    <div class="blc-CardIcon-Container">
      <$list filter="[<currentCardTiddler>has:value[text]!is[image]]" variable="">
        <$list filter="[<currentBoardTiddler>field:displayText[no]]" variable="">
          <div class="blc-CardIcon-HasText" title="This tiddler contains text. Open in main story to view.">
          <span class="inlineImg inlineImg-help">{{$:/core/images/import-button}}</span>
          </div>
        </$list>
      </$list>
      <$list filter="[<currentCardTiddler>has[list]]" variable="">
        <div class="blc-CardIcon-HasList" title="This tiddler contains a list.">
        <span class="inlineImg inlineImg-help">{{$:/core/images/storyview-classic}}</span>
        </div>
      </$list>
    </div>
    <div title={{!!title}} class="blc-CardText">
      <$set name="field-shorttextOrTitle" filter="[<currentTiddler>has[shorttext]]" value="shorttext" emptyValue="title">
        <p class="blc-shorttext_container">
          <$transclude field=<<field-shorttextOrTitle>> mode="inline" class="" />
        </p>
      </$set>
      <$set name="wikitext-LargeContent" filter="[<currentCardTiddler>is[image]]"
          value=<<wikitext-Image-IfImageDisplay>>
          emptyValue=<<wikitext-Text-IfTextDisplay>> >
        <<wikitext-LargeContent>>
      </$set>
    </div>
  </$draggable>
\end